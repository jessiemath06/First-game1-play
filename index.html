<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jessie Math - è¿·å®®æ ¸å¿ƒé‘°åŒ™</title>
    
    <meta name="description" content="Â© 2025â€“2026 Jessie Math æ·æè€å¸«. All rights reserved.">
    <meta property="og:title" content="Jessie Math - è¿·å®®æ ¸å¿ƒé‘°åŒ™">
    <meta property="og:description" content="Â© 2025â€“2026 Jessie Math æ·æè€å¸«. All rights reserved.">
    <meta property="og:type" content="website">
    
    <meta property="og:image" content="g6-u1-2.png">
    <meta property="og:image:width" content="1024">
    <meta property="og:image:height" content="1536">
    <meta property="og:image:alt" content="Jessie Math éŠæˆ²å°é¢">
    
    <link rel="image_src" href="g6-u1-2.png">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Jessie Math - è¿·å®®æ ¸å¿ƒé‘°åŒ™">
    <meta name="twitter:description" content="Â© 2025â€“2026 Jessie Math æ·æè€å¸«. All rights reserved.">
    <meta name="twitter:image" content="g6-u1-2.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ====== å…¨åŸŸèˆ‡å­—é«”è¨­å®š ====== */
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@800&family=Noto+Sans+TC:wght@500;700;900&display=swap');
        
        body {
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #2b2b2b, #1a1a1a);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
        }

        /* ====== æ‰‹æ©Ÿç›´å‘è­¦å‘Šæç¤º (RWD æ‰‹æ©Ÿå¼·åˆ¶æ©«å‘) ====== */
        #orientation-warning {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #1a1a1a;
            color: #f1c40f;
            z-index: 9999;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }

        #orientation-warning i {
            font-size: 48px;
            margin-bottom: 20px;
            animation: rotatePhone 1.5s infinite ease-in-out;
        }

        @keyframes rotatePhone {
            0% { transform: rotate(0deg); }
            50% { transform: rotate(-90deg); }
            100% { transform: rotate(-90deg); }
        }

        /* ç•¶è¢å¹•å¯¬åº¦å°æ–¼ 768px (æ‰‹æ©Ÿå°ºå¯¸) ä¸”ç‚ºç›´å‘ (portrait) æ™‚é¡¯ç¤ºè­¦å‘Š */
        @media screen and (max-width: 767px) and (orientation: portrait) {
            #orientation-warning {
                display: flex;
            }
            body {
                overflow: hidden; /* é–å®šèƒŒæ™¯æ»¾å‹• */
            }
        }

        /* ====== å°è¦½åˆ— (Heroå€) ====== */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 30px;
            background-color: #ffffff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .brand img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid #e67e22;
            background-color: transparent;
            object-fit: contain;
        }

        .brand-name {
            font-family: 'Nunito', sans-serif;
            font-size: 28px;
            font-weight: 800;
            color: #2c3e50;
            letter-spacing: 0.5px;
        }

        .nav-links {
            display: flex;
            gap: 15px;
        }

        .nav-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-size: 16px;
            font-weight: 700;
            border: 1px solid #dcdde1;
            color: #353b48;
            background-color: #fff;
            transition: all 0.2s;
        }

        .nav-btn:hover {
            background-color: #f5f6fa;
        }

        .nav-btn.active-back {
            border-color: #7b61ff;
            color: #7b61ff;
            background-color: #f8f5ff;
        }

        .nav-btn.active-back:hover {
            background-color: #f0eaff;
        }

        /* ====== éŠæˆ²å®¹å™¨è¨­å®š ====== */
        .container {
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            flex: 1;
            width: 100%;
            box-sizing: border-box;
        }

        .stone-panel {
            background: linear-gradient(to bottom, #596275, #303952);
            border: 8px solid #2f3640;
            border-radius: 15px;
            box-shadow: 
                inset 0 0 20px rgba(0,0,0,0.5),
                10px 10px 30px rgba(0,0,0,0.6);
            padding: 30px;
            position: relative;
        }

        /* ====== ç¬¬ä¸€é ï¼šç™»å…¥èˆ‡è¦å‰‡ ====== */
        #start-screen {
            text-align: center;
        }

        .game-title {
            font-size: 42px;
            color: #f1c40f;
            text-shadow: 2px 2px 5px #000;
            margin-bottom: 10px;
            font-weight: 900;
        }

        .game-subtitle {
            font-size: 18px;
            color: #bdc3c7;
            margin-bottom: 30px;
        }

        .input-group {
            margin: 20px 0;
        }

        .input-group input {
            padding: 15px 25px;
            font-size: 18px;
            border-radius: 30px;
            border: 2px solid #f1c40f;
            background: rgba(255,255,255,0.1);
            color: #fff;
            text-align: center;
            width: 60%;
            outline: none;
        }

        .start-btn {
            padding: 15px 40px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 30px;
            border: none;
            background: linear-gradient(to right, #e67e22, #f1c40f);
            color: #2c3e50;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(241, 196, 15, 0.4);
            transition: transform 0.1s;
        }

        .start-btn:active {
            transform: scale(0.95);
        }

        .rules {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: left;
            border-left: 5px solid #e67e22;
        }

        /* ====== ç¬¬äºŒé ï¼šéŠæˆ²ä¸»ç•«é¢ ====== */
        #game-screen {
            display: none;
            text-align: center;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 18px;
            margin-bottom: 20px;
            color: #f1c40f;
            font-weight: bold;
        }

        /* éœéŸ³æŒ‰éˆ• */
        .mute-btn {
            background: none;
            border: none;
            color: #f1c40f;
            font-size: 24px;
            cursor: pointer;
            transition: transform 0.2s;
            outline: none;
        }

        .mute-btn:hover {
            transform: scale(1.1);
        }

        /* æ ¸å¿ƒå¯†ç¢¼é– */
        .core-lock {
            background: #222f3e;
            border: 10px solid #10ac84;
            border-radius: 50%;
            width: 200px;
            height: 200px;
            margin: 0 auto 30px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 30px rgba(16, 172, 132, 0.5);
            transition: all 0.5s;
            position: relative;
        }

        .lock-number {
            font-size: 72px;
            font-weight: 900;
            color: #1dd1a1;
            text-shadow: 0 0 10px #1dd1a1;
        }

        /* çŸ­é™¤æ³•æ­·ç¨‹ */
        .history-board {
            min-height: 80px;
            background: rgba(0,0,0,0.4);
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 20px;
            font-size: 24px;
            color: #c8d6e5;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .history-step {
            background: #e67e22;
            color: #fff;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        /* è³ªæ•¸é½’è¼ªæŒ‰éˆ• */
        .prime-gears {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .gear-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #7f8c8d, #95a5a6);
            color: #2c3e50;
            font-size: 24px;
            font-weight: 900;
            cursor: pointer;
            box-shadow: 2px 5px 10px rgba(0,0,0,0.5);
            border: 3px dashed #34495e;
            transition: all 0.2s;
        }

        .gear-btn.text-btn {
            font-size: 18px;
            letter-spacing: 1px;
            background: linear-gradient(135deg, #f39c12, #f1c40f);
            border-color: #d35400;
        }

        .gear-btn:hover {
            transform: rotate(15deg) scale(1.1);
            background: linear-gradient(135deg, #bdc3c7, #ecf0f1);
        }

        .gear-btn.text-btn:hover {
            background: linear-gradient(135deg, #f1c40f, #f39c12);
        }

        .gear-btn:active {
            transform: scale(0.9);
        }

        /* ====== å‹•æ•ˆè¨­è¨ˆ ====== */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        .error-shake {
            animation: shake 0.5s;
            border-color: #e74c3c !important;
            box-shadow: 0 0 30px rgba(231, 76, 60, 0.8) !important;
        }
        .lock-number.error-text {
            color: #e74c3c;
            text-shadow: 0 0 10px #e74c3c;
        }

        @keyframes openDoor {
            0% { transform: scale(1); opacity: 1; }
            40% { transform: scale(1.1); box-shadow: 0 0 80px rgba(241, 196, 15, 1); }
            100% { transform: scale(2); opacity: 0; }
        }
        .door-open-anim {
            animation: openDoor 1.5s forwards;
            pointer-events: none;
        }

        /* ====== ç¬¬ä¸‰é ï¼šé€šé—œèˆ‡å‹³ç« ç•«é¢ ====== */
        #win-screen {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }

        .win-title {
            font-size: 48px;
            color: #f1c40f;
            text-shadow: 0 0 15px rgba(241, 196, 15, 0.8);
            margin-bottom: 20px;
            font-weight: 900;
        }

        .medal-img {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 6px solid #f1c40f;
            box-shadow: 0 0 30px rgba(241, 196, 15, 0.8), inset 0 0 10px rgba(0,0,0,0.5);
            object-fit: cover;
            margin: 20px auto;
            display: block;
            animation: popIn 1s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes popIn {
            0% { transform: scale(0) rotate(-180deg); opacity: 0; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        /* ====== é å°¾ (Footer) å°ˆå±¬å“ç‰Œè¨­è¨ˆ ====== */
        footer {
            margin-top: auto;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .footer-pill {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px 30px;
            border-radius: 50px;
            gap: 30px;
            backdrop-filter: blur(5px);
            flex-wrap: wrap;
        }

        .footer-left, .footer-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .footer-dot {
            width: 8px;
            height: 8px;
            background-color: #f1c40f;
            border-radius: 50%;
            box-shadow: 0 0 8px #f1c40f;
        }

        .footer-copy, .footer-tagline {
            color: #bdc3c7;
            font-size: 14px;
            letter-spacing: 0.5px;
        }

        .footer-icon i {
            color: #e67e22;
            font-size: 18px;
        }

        /* ====== RWD ç´°ç¯€èª¿æ•´ (é‡å°å°è¢å¹•èˆ‡å¹³æ¿) ====== */
        @media screen and (max-width: 900px) {
            .navbar {
                flex-wrap: wrap;
                justify-content: center;
                gap: 15px;
                padding: 15px;
            }
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }
            .core-lock {
                width: 150px;
                height: 150px;
            }
            .lock-number {
                font-size: 50px;
            }
            .gear-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            .gear-btn.text-btn {
                font-size: 15px;
            }
            .game-title {
                font-size: 32px;
            }
            .footer-pill {
                flex-direction: column;
                gap: 10px;
                border-radius: 20px;
                padding: 15px;
            }
        }
    </style>
</head>
<body>

    <div id="orientation-warning">
        <i class="fa-solid fa-mobile-screen-button"></i>
        <span>ç‚ºç²å¾—æœ€ä½³éŠæˆ²é«”é©—<br>è«‹å°‡æ‰‹æ©Ÿè½‰ç‚ºã€Œæ©«å‘ã€é€²è¡ŒéŠæˆ²</span>
    </div>

    <header class="navbar">
        <div class="brand">
            <img src="JESSIEMATH-Q.png" alt="Jessie Math">
            <span class="brand-name">Jessie Math</span>
        </div>
        <div class="nav-links">
            <a href="https://jessiemath0703-chu.github.io/website2/" class="nav-btn">
                <i class="fa-solid fa-house" style="color: #4285F4;"></i> é¦–é 
            </a>
            <a href="https://jessiemath0703-chu.github.io/Game-Lobby/" class="nav-btn">
                <i class="fa-solid fa-gamepad" style="color: #4285F4;"></i> éŠæˆ²å¤§å»³
            </a>
            <a href="https://jessiemath0703-chu.github.io/Game-Lobby/#g6-u1" class="nav-btn active-back">
                <i class="fa-solid fa-rotate-left"></i> å…­å¹´ç´šè³ªå› æ•¸åˆ†è§£èˆ‡çŸ­é™¤æ³•
            </a>
        </div>
    </header>

    <div class="container">
        <div id="start-screen" class="stone-panel">
            <h1 class="game-title">è¿·å®®æ ¸å¿ƒé‘°åŒ™</h1>
            <div class="game-subtitle">g6-U1 è³ªå› æ•¸çŸ­é™¤ ï½œ å•Ÿå‹•å·¨å¤§æ©Ÿæ¢°çŸ³é–€</div>
            
            <div class="input-group">
                <input type="text" id="playerName" placeholder="è«‹è¼¸å…¥æ¢éšªå®¶å§“å..." autocomplete="off">
            </div>
            
            <button class="start-btn" onclick="startGame()">é€²å…¥è¿·å®®</button>

            <div class="rules">
                <h3>ğŸ“œ è¿·å®®ç”Ÿå­˜æ³•å‰‡ï¼š</h3>
                <p>1. å·¨å¤§çš„çŸ³é–€è¢«å¯†ç¢¼é–ä¸Šäº†ï¼Œä½ å¿…é ˆä½¿ç”¨çŸ­é™¤æ³•ä¾†æ‹†è§£å¯†ç¢¼ã€‚</p>
                <p>2. é»æ“Šä¸‹æ–¹çš„ã€Œè³ªæ•¸é½’è¼ªã€ï¼Œè‹¥èƒ½æ•´é™¤é–ä¸Šçš„æ•¸å­—ï¼Œå°±èƒ½å‰Šæ¸›çŸ³é–€çš„é˜²ç¦¦å€¼ã€‚å¦‚æœå‰©ä¸‹çš„æ•¸å­—æœ¬èº«å°±æ˜¯è³ªæ•¸ï¼Œå¯ä»¥ç›´æ¥é»æ“Šã€Œè³ªæ•¸ã€æŒ‰éˆ•ï¼</p>
                <p>3. å°‡æ•¸å­—ä¸€è·¯åˆ†è§£ç›´åˆ°è®Šæˆ 1ï¼Œå°±èƒ½é–‹å•ŸçŸ³é–€å‰å¾€ä¸‹ä¸€å±¤ï¼</p>
                <p>4. âš ï¸ æŒ‘æˆ°ç›®æ¨™ï¼šé€£çºŒæˆåŠŸé–‹å•Ÿ 15 æ‰‡çŸ³é–€ï¼Œå³å¯ç²å¾—å°ˆå±¬å‹³ç« ï¼è‹¥ä¸­é€”æŒ‰éŒ¯é½’è¼ªï¼Œé€£çºŒç´€éŒ„å°‡æœƒæ­¸é›¶å–”ï¼</p>
            </div>
        </div>

        <div id="game-screen" class="stone-panel">
            <div class="status-bar">
                <span id="displayPlayerName"><i class="fa-solid fa-user"></i> ç©å®¶ï¼š</span>
                <span id="scoreDisplay" style="color:#1dd1a1;"><i class="fa-solid fa-door-open"></i> é€£çºŒé–‹å•Ÿï¼š0 / 15 æ‰‡</span>
                <button id="muteBtn" class="mute-btn" onclick="toggleMute()" title="é–‹å•Ÿ/é—œé–‰éŸ³æ•ˆ">
                    <i class="fa-solid fa-volume-high" id="muteIcon"></i>
                </button>
            </div>

            <div class="core-lock" id="coreLock">
                <div class="lock-number" id="currentNumber">60</div>
            </div>

            <div class="history-board" id="historyBoard">
                ç­‰å¾…è¼¸å…¥è³ªå› æ•¸...
            </div>

            <h3>âš™ï¸ é¸æ“‡è³ªæ•¸é½’è¼ªé€²è¡Œåˆ†è§£ï¼š</h3>
            <div class="prime-gears">
                <button class="gear-btn" onclick="attemptDivide(2)">2</button>
                <button class="gear-btn" onclick="attemptDivide(3)">3</button>
                <button class="gear-btn" onclick="attemptDivide(5)">5</button>
                <button class="gear-btn" onclick="attemptDivide(7)">7</button>
                <button class="gear-btn" onclick="attemptDivide(11)">11</button>
                <button class="gear-btn" onclick="attemptDivide(13)">13</button>
                <button class="gear-btn text-btn" onclick="attemptDivide('prime')">è³ªæ•¸</button>
            </div>
        </div>

        <div id="win-screen" class="stone-panel">
            <h2 class="win-title">ğŸ‰ è©¦ç…‰å®Œæˆï¼</h2>
            <p style="font-size: 20px; line-height: 1.6;">å¤ªå²å®³äº†ï¼Œæ¢éšªå®¶ <span id="winPlayerName" style="color:#e67e22; font-weight:bold;"></span>ï¼<br>ä½ æˆåŠŸé€£çºŒé–‹å•Ÿäº† 15 æ‰‡é‡å‹çŸ³é–€ï¼Œå®Œç¾æŒæ¡äº†çŸ­é™¤æ³•çš„å¥§ç§˜ï¼</p>
            
            <img src="G6-U1.jpg" alt="è¿·å®®æ ¸å¿ƒå‹³ç« " class="medal-img">
            
            <p style="font-size: 24px; color: #1dd1a1; font-weight: bold; margin-bottom: 30px;">ç²å¾—æ¦®è­½ï¼šè¿·å®®æ ¸å¿ƒå‹³ç« </p>
            
            <button class="start-btn" onclick="location.reload()">å†æ¬¡æŒ‘æˆ°</button>
        </div>
    </div>

    <footer>
        <div class="footer-pill">
            <div class="footer-left">
                <div class="footer-dot" aria-hidden="true"></div>
                <div class="footer-copy">Â© 2025â€“2026 Jessie Math æ·æè€å¸«. All rights reserved.</div>
            </div>
            <div class="footer-right">
                <div class="footer-icon" aria-hidden="true"><i class="fas fa-compass"></i></div>
                <div class="footer-tagline">æ•¸å­¸ä¸è¿·è·¯ï¼ŒJessieå¸¶ä½ èµ°å‘ç†è§£ã€‚</div>
            </div>
        </div>
    </footer>

    <script>
        let playerName = "";
        let targetNumber = 0;
        let currentNumber = 0;
        let score = 0; // é€£çºŒé€šé—œæ•¸
        let factorsHistory = [];
        let isAnimating = false;
        let isMuted = false;

        // ã€éŸ³æ•ˆç®¡ç†ç³»çµ±ï¼šç¢ºä¿æ‰€æœ‰éŸ³æ•ˆçš†ä¸é‡ç–Šä¸”æ”¯æ´éœéŸ³ã€‘
        let currentAudio = null;
        let audioTimeout = null;

        function toggleMute() {
            isMuted = !isMuted;
            const icon = document.getElementById('muteIcon');
            if (isMuted) {
                icon.className = 'fa-solid fa-volume-xmark';
                if (currentAudio) {
                    currentAudio.pause();
                }
            } else {
                icon.className = 'fa-solid fa-volume-high';
            }
        }

        function playSound(src, limitTime = 0) {
            if (isMuted) return; // éœéŸ³æ¨¡å¼ä¸‹ä¸æ’­æ”¾

            // å¦‚æœç•¶å‰æœ‰éŸ³æ•ˆæ­£åœ¨æ’­æ”¾ï¼Œå¼·åˆ¶æš«åœä¸¦é‡ç½®
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }
            if (audioTimeout) {
                clearTimeout(audioTimeout);
                audioTimeout = null;
            }

            // å»ºç«‹æ–°éŸ³æ•ˆä¸¦æ’­æ”¾
            currentAudio = new Audio(src);
            currentAudio.play().catch(e => console.log("ç­‰å¾…ä½¿ç”¨è€…äº’å‹•æˆ–éŸ³æ•ˆéŒ¯èª¤ï¼š", e));

            // è‹¥æœ‰è¨­å®šé™åˆ¶æ™‚é–“ (æ¯«ç§’)ï¼Œå‰‡æ™‚é–“åˆ°å¾Œå¼·åˆ¶åœæ­¢
            if (limitTime > 0) {
                audioTimeout = setTimeout(() => {
                    if (currentAudio) {
                        currentAudio.pause();
                        currentAudio.currentTime = 0;
                    }
                }, limitTime);
            }
        }

        // ã€è³ªæ•¸åˆ¤æ–·å‡½æ•¸ã€‘
        function isPrime(num) {
            if (num <= 1) return false;
            if (num <= 3) return true;
            if (num % 2 === 0 || num % 3 === 0) return false;
            for (let i = 5; i * i <= num; i += 6) {
                if (num % i === 0 || num % (i + 2) === 0) return false;
            }
            return true;
        }

        // ã€æ“´å……å°ˆå±¬æ•¸å­—é¡Œåº«ï¼šåŠ å…¥ 13, 17, 19, 23, 29 çš„å› æ•¸åŠç´”è³ªæ•¸ã€‘
        const puzzleBankTemplate = [
            // åŸºæœ¬å¸¸ç”¨é¡Œå‹
            12, 14, 15, 18, 20, 24, 27, 28, 30, 32, 36, 40, 42, 45, 48, 
            50, 54, 56, 60, 63, 64, 70, 72, 75, 80, 84, 90, 96, 98, 100, 
            105, 108, 112, 120, 126, 130, 135, 140, 144, 150,
            // å«æœ‰å¤§è³ªå› æ•¸çš„ç‰¹åˆ¥æ•¸å­—
            26, 39, 65, /* 13çš„å€æ•¸ */
            34, 51, 85, /* 17çš„å€æ•¸ */
            38, 57, 95, /* 19çš„å€æ•¸ */
            46, 69,     /* 23çš„å€æ•¸ */
            58, 87,     /* 29çš„å€æ•¸ */
            // ç´”è³ªæ•¸é¡Œ
            13, 17, 19, 23, 29, 31, 37, 41, 43, 47
        ];
        let currentPuzzleBank = [];

        // æ´—ç‰Œæ¼”ç®—æ³• (Fisher-Yates Shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // å¾é¡Œåº«æŠ½é¡Œï¼Œå¦‚æœæŠ½å®Œå°±é‡æ–°è¤‡è£½ä¸€ä»½é¡Œåº«ä¸¦æ´—ç‰Œ
        function getNextPuzzle() {
            if (currentPuzzleBank.length === 0) {
                currentPuzzleBank = [...puzzleBankTemplate]; // è¤‡è£½åŸé¡Œåº«
                shuffleArray(currentPuzzleBank); // æ´—ç‰Œ
            }
            return currentPuzzleBank.pop(); // æŠ½å‡ºæœ€å¾Œä¸€é¡Œ
        }

        function startGame() {
            const nameInput = document.getElementById("playerName").value.trim();
            if (nameInput === "") {
                alert("è«‹å…ˆè¼¸å…¥ä½ çš„å§“åï¼Œæ‰èƒ½é€²å…¥è¿·å®®ï¼");
                return;
            }
            
            playerName = nameInput;
            document.getElementById("displayPlayerName").innerHTML = `<i class="fa-solid fa-user"></i> æ¢éšªå®¶ï¼š${playerName}`;
            document.getElementById("winPlayerName").innerText = playerName;
            
            document.getElementById("start-screen").style.display = "none";
            document.getElementById("game-screen").style.display = "block";

            initNewLevel();
        }

        function initNewLevel() {
            // ä½¿ç”¨æ´—ç‰Œæ©Ÿåˆ¶çš„æ•¸å­—
            targetNumber = getNextPuzzle();
            currentNumber = targetNumber;
            factorsHistory = [];
            isAnimating = false;
            
            updateLockDisplay();
            document.getElementById("historyBoard").innerHTML = "æº–å‚™å•Ÿå‹•åˆ†è§£ç¨‹åº...";
            
            const lock = document.getElementById("coreLock");
            lock.classList.remove("door-open-anim");
            lock.style.borderColor = "#10ac84";
            lock.style.boxShadow = "0 0 30px rgba(16, 172, 132, 0.5)";
            lock.style.transform = "scale(1)";
            lock.style.opacity = "1";

            // é€²å…¥æ–°çš„ä¸€é¡Œæ™‚ï¼Œè§¸ç™¼æ’­æ”¾ 5.mp3 (ä¸é‡ç–Š)
            playSound('5.mp3');
        }

        function updateLockDisplay() {
            document.getElementById("currentNumber").innerText = currentNumber;
            document.getElementById("scoreDisplay").innerHTML = `<i class="fa-solid fa-door-open"></i> é€£çºŒé–‹å•Ÿï¼š${score} / 15 æ‰‡`;
        }

        function attemptDivide(prime) {
            if(isAnimating) return;

            const lock = document.getElementById("coreLock");
            const numberText = document.getElementById("currentNumber");

            let isCorrect = false;
            let dividedBy = prime;

            // åˆ¤æ–·ç©å®¶é»æ“Šçš„æ˜¯ä¸æ˜¯ã€Œè³ªæ•¸ã€æŒ‰éˆ•
            if (prime === 'prime') {
                if (isPrime(currentNumber)) {
                    isCorrect = true;
                    dividedBy = currentNumber; // ç›´æ¥ä»¥ç•¶å‰çš„ç´”è³ªæ•¸ä½œç‚ºå› æ•¸é™¤æ‰
                }
            } else {
                if (currentNumber % prime === 0) {
                    isCorrect = true;
                }
            }

            if (isCorrect) {
                // ç­”å°éš¨æ©Ÿæ’­æ”¾ 2.mp3 æˆ– 4.mp3ï¼Œæ™‚é–“ç´„å…©ç§’å³è‡ªå‹•ä¸­æ–· (ä¸é‡ç–Š)
                const correctAudio = Math.random() < 0.5 ? '2.mp3' : '4.mp3';
                playSound(correctAudio, 2000);

                currentNumber = currentNumber / dividedBy;
                factorsHistory.push(dividedBy);
                
                let historyHTML = factorsHistory.map(p => `<span class="history-step">Ã· ${p}</span>`).join(" ");
                document.getElementById("historyBoard").innerHTML = historyHTML;
                
                updateLockDisplay();

                if (currentNumber === 1) {
                    isAnimating = true;
                    score++;
                    updateLockDisplay();
                    
                    lock.style.borderColor = "#f1c40f";
                    numberText.innerText = "OPEN";
                    
                    if (score >= 15) {
                        // é€šé—œæ’­æ”¾ 3.mp3 (ä¹Ÿæœƒè‡ªå‹•åˆ‡æ–·ä¹‹å‰çš„éŸ³æ•ˆ)
                        playSound('3.mp3');

                        setTimeout(() => {
                            document.getElementById("game-screen").style.display = "none";
                            document.getElementById("win-screen").style.display = "block";
                        }, 800);
                    } else {
                        lock.classList.add("door-open-anim");
                        document.getElementById("historyBoard").innerHTML = "âœ¨ çŸ³é–€é–‹å•Ÿï¼å‰å¾€ä¸‹ä¸€å±¤...";
                        
                        setTimeout(() => {
                            initNewLevel();
                        }, 1500);
                    }
                }
            } else {
                // ç­”éŒ¯æ’­æ”¾ 1.mp3 (ä¸é‡ç–Š)
                playSound('1.mp3');

                score = 0;
                updateLockDisplay();
                
                document.getElementById("historyBoard").innerHTML = "âš ï¸ å¯†ç¢¼éŒ¯èª¤ï¼é˜²ç¦¦ç³»çµ±é‡å•Ÿï¼Œé€£çºŒç´€éŒ„æ­¸é›¶ï¼";
                
                lock.classList.add("error-shake");
                numberText.classList.add("error-text");
                
                setTimeout(() => {
                    lock.classList.remove("error-shake");
                    numberText.classList.remove("error-text");
                }, 500);
            }
        }
    </script>
</body>
</html>